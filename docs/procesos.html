<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesos de Producción</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link href="css/procesos.css" rel="stylesheet">
    <style>
        body,
        html {
            font-family: Helvetica, Sans-Serif !important;
        }
    </style>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #003057;">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="img/INEGI_g.png" alt="Logo INEGI" style="width: 9rem; filter: invert(1) brightness(2) contrast(1.5);">
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                <ul class="navbar-nav mx-auto gap-3">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active fw-bold text-decoration-underline" aria-current="page" href="procesos.html">Procesos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="variables.html">Variables</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="ods.html">ODS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="indicadores.html">Indicadores existentes</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!--Imagen encabezado de Procesos-->
    <div class="container-fluid p-0">
        <div style="position: relative; width: 100%; height: 300px; overflow: hidden;">
            <img src="img/encabezado_procesos.JPG" alt="Encabezado" style="width: 100%; height: 100%; object-fit: cover;">
            <div style="position: absolute; bottom: 20px; left: 40px; color: white; font-size: 2.5rem; font-weight: bold; text-shadow: 2px 2px 5px rgba(0,0,0,0.7);">
                Procesos de Producción
            </div>
        </div>
    </div>

    <!-- Contenedor de información en contexto -->

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2 class="mb-4">Información en contexto</h2>
                <p class="lead">La información en contexto es un conjunto de datos que permite entender y analizar un fenómeno o situación específica. En el caso de los procesos de producción, esta información es crucial para la toma de decisiones y la planificación estratégica.</p>
                <p>En esta sección, podrás explorar los diferentes procesos de producción y las variables ambientles asociadas a cada uno de ellos. Utiliza el menú desplegable para seleccionar un proceso específico y ver sus detalles.</p>
            </div>
        </div>
        <p>Procesos de Producción de Información del INEGI

            El Instituto Nacional de Estadística y Geografía (INEGI) lleva a cabo sus procesos de producción de información estadística y geográfica bajo un riguroso marco normativo que garantiza la calidad, pertinencia, veracidad y oportunidad de los datos generados.

            Basado en los Principios Fundamentales de las Estadísticas Oficiales de Naciones Unidas y en su propia normativa interna, el INEGI estructura sus procesos en fases claramente definidas: documentación de necesidades, diseño, construcción, captación, procesamiento, análisis, difusión y evaluación. Cada fase asegura la generación de información comparable, accesible y alineada a estándares nacionales e internacionales.

            Esta sección ofrece una visión detallada de los procesos que sustentan la producción de información estratégica, contribuyendo al fortalecimiento del Sistema Nacional de Información Estadística y Geográfica (SNIEG) y al desarrollo nacional, en apego a los más altos principios de transparencia, independencia y objetividad.</p>
    </div>

    <div class="container mt-4 mb-3">
        <h2 class="mb-2">Unidades Administrativa</h2>
        <hr>

        <div class="row row-cols-1 row-cols-md-3 g-4">
            <!-- Dirección General de Estadísticas Sociodemográficas -->
            <div class="col">
                <div class="card h-100 text-center custom-card-btn mostrarGrupoBtn" id="btnDireccionSociodemograficas">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <i class="bi bi-bar-chart display-4 mb-3 iconcustom"></i>
                    </div>
                    <h5 class="card-title texto-direction nameofDirection">
                       Unidad de Estadísticas Sociodemográficas
                    </h5>
                </div>
            </div>
            <!--  Dirección General de Estadísticas Económicas-->
            <div class="col">
                <div class="card h-100 text-center custom-card-btn mostrarGrupoBtn" data-grupo="grupo2">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <i class="bi bi-cash-stack display-4 mb-3 iconcustom"></i>
                        <h5 class="card-title texto-direction nameofDirection">
                            Unidad de Estadísticas Económicas
                        </h5>
                    </div>
                </div>
            </div>
            <!-- Dirección General de Geografía y Medio Ambiente -->
            <div class="col">
                <div class="card h-100 text-center custom-card-btn mostrarGrupoBtn" data-grupo="grupo3">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <i class="bi bi-globe display-4 mb-3 iconcustom"></i>
                        <h5 class="card-title texto-direction nameofDirection">
                           Unidad de Geografía y Medio Ambiente
                        </h5>
                    </div>
                </div>
            </div>
            <!-- Dirección General de Estadísticas de Gobierno, Seguridad Pública y Justicia -->
            <div class="col">
                <div class="card h-100 text-center custom-card-btn mostrarGrupoBtn" data-grupo="grupo4">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <i class="bi bi-bank display-4 mb-3 iconcustom"></i>
                        <h5 class="card-title texto-direction nameofDirection">
                            Unidad de Estadísticas de Gobierno, Seguridad Pública y Justicia
                        </h5>
                    </div>
                </div>
            </div>
            <!-- Dirección General de Integración, Análisis e Investigación -->
            <div class="col">
                <div class="card h-100 text-center custom-card-btn mostrarGrupoBtn" data-grupo="grupo5">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <i class="bi bi-file-earmark-text display-4 mb-3 iconcustom"></i>
                        <h5 class="card-title texto-direction nameofDirection">
                            Dirección General de Integración, Análisis e Investigación
                        </h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comentado: Programas de información y contenedor dinámico -->
    <!--
    <div class="container">
        <div class="mt-5">
            <h2>Programas de información</h2>
            <div class="mt-4 d-none" id="grupo1Container">
                <div class="row">
                    <div class="col-3 m-1">
                        <button class="custom-card-btn mostrarProcesosBtn" data-categoria="InformacionDemografica" id="btnProcesosDemograficos">
                            <div class="d-flex justify-content-center align-items-center">
                                <i class="bi bi-person-circle display-5 iconcustom"></i>
                            </div>
                            <div class="text-center">
                                <label class="texto-direction nameofDirection">Programa Información Demográfica y Social</label>
                                <h5>Total de procesos: <span id="procesosCounter">0</span></h5>
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="mt-5 mb-5">
                <h2>Procesos de Producción</h2>
            </div>
            <div class="row mt-4" id="procesosContainer"></div>
        </div>
    </div>
    -->

    <!-- Contenedor donde se mostrarán los procesos -->
    <div class="container mt-5" id="procesosSection" hidden>
        <div class="d-flex justify-content-between align-items-center flex-wrap mb-3">
            <h2 class="mb-2 mb-lg-0">Procesos de Producción</h2>
        </div>

        <hr>
        <div class="d-flex justify-content-between align-items-center mb-2 flex-wrap">
            <div>
                <strong>Total de procesos: <span id="procesosCounter">0</span></strong>
            </div>
            <div class="d-flex align-items-center flex-wrap gap-2">
                <select id="ordenarProcesos" class="form-select w-auto flex-shrink-0">
                    <option value="">Ordenar por...</option>
                    <option value="az">Nombre (A - Z)</option>
                    <option value="za">Nombre (Z - A)</option>
                    <option value="menor-mayor">Cantidad de variables (Menor a mayor)</option>
                    <option value="mayor-menor">Cantidad de variables (Mayor a menor)</option>
                </select>

                <select id="filtrarEstatus" class="form-select w-auto flex-shrink-0">
                    <option value="">Filtrar por estatus...</option>
                    <option value="Activo">Activo</option>
                    <option value="Inactivo">Inactivo</option>
                    <option value="Histórico">Histórico</option>
                    <option value="iin">Información de Interés Nacional</option>
                </select>

                <select id="filtrarPeriodicidad" class="form-select w-auto flex-shrink-0">
                    <option value="">Filtrar por periodicidad...</option>
                </select>

                <button id="resetFiltrosBtn" class="btn btn-outline-danger flex-shrink-0" title="Restablecer filtros">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>
        <!-- Contenedor dinamico que muestra los procesos.  -->
        <div class="row mt-4" id="procesosContainer"></div>
    </div>

    <script>
        // Esta función debe estar FUERA del DOMContentLoaded para que sea accesible desde el HTML generado
        function handleVariableClick(idPp) {
            window.open(`variables.html?idPp=${idPp}`, '_blank');
        }


        document.addEventListener("DOMContentLoaded", async function () {
            const currentPath = window.location.pathname.split("/").pop();
            const navLinks = document.querySelectorAll(".navbar-nav .nav-link");

            navLinks.forEach(link => {
                const href = link.getAttribute("href");
                if (href === currentPath) {
                    link.classList.add("active");
                }
            });

            const btnMostrar = document.getElementById("btnDireccionSociodemograficas");
            const seccionProcesos = document.getElementById("procesosSection");
            const container = document.getElementById("procesosContainer");

            let procesosGlobal = [];
            let conteoGlobal = [];

            if (btnMostrar && seccionProcesos) {
                btnMostrar.addEventListener("click", async function () {
                    seccionProcesos.hidden = false;
                    seccionProcesos.scrollIntoView({ behavior: 'smooth' });

                    try {
                        const procesos = await fetch("https://upcoming-accent-msgid-rendering.trycloudflare.com/api/proceso").then(res => res.json());
                        const variables = await fetch('https://upcoming-accent-msgid-rendering.trycloudflare.com/api/variables').then(res => res.json());

                        procesosGlobal = procesos;
                        conteoGlobal = {};

                        procesos.forEach(proceso => {
                            const relacionadas = variables.filter(v => v.idPp === proceso.idPp);
                            conteoGlobal[proceso.idPp] = relacionadas.length;
                        });

                        // Siempre muestra todos los procesos al inicio
                        renderProcesos(procesosGlobal, conteoGlobal);

                    } catch (err) {
                        console.error("Error cargando datos", err);
                        container.innerHTML = "<p class='text-danger'>Error al cargar los procesos.</p>";
                    }
                });
            }

            function renderProcesos(procesos, conteo) {
                // Actualiza el contador dinámicamente
                const counter = document.getElementById("procesosCounter");
                if (counter) counter.textContent = procesos.length;

                container.innerHTML = "";
                procesos.forEach(proceso => {
                    const card = `
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 shadow-sm rounded-3 p-2 position-relative">
                                ${proceso.gradoMadur === "Información de Interés Nacional" ? `
                                    <span class="badge bg-secondary position-absolute top-0 start-0 m-2 "
                                          style="z-index:2; cursor: help;"
                                          data-bs-toggle="tooltip"
                                          data-bs-placement="right"
                                          title="Información de Interés Nacional">
                                        IIN
                                    </span>
                                ` : ""}
                                <div class="row g-0 d-flex align-items-center">
                                    <div class="col-4 d-flex justify-content-center">
                                        <img src="img/iconsociodemografica.png" class="img-fluid proceso-icon rounded-start" alt="Icono" style="max-height: 80px;">
                                    </div>
                                    <div class="col-8">
                                        <div class="card-body p-2">
                                            <h5 class="card-title fw-bold mb-1">${proceso.pp || "Desconocido"}</h5>
                                            <p class="card-text text-muted mb-1">${proceso.idPp}</p>
                                            <p class="card-text mb-1">
                                                <strong style="font-size: 0.85rem">Estatus:</strong>
                                                <span class="badge ${getStatusClass(proceso.estatus)}">${proceso.estatus}</span>
                                            </p>
                                            <p class="card-text mb-1" style="font-size: 0.85rem">
                                                <strong style="font-size: 0.85rem">Periodicidad:</strong>
                                                ${proceso.perioProd || "No disponible"}
                                            </p>
                                            <p class="card-text mb-1" style="font-size: 0.85rem">
                                                <strong style="font-size: 0.85rem">Vigencia:</strong>
                                                ${mostrarVigencia(proceso.vigInicial, proceso.vigFinal)}
                                            </p>
                                            <p class="card-text mb-0">  
                                                <strong>Total Variables:</strong>
                                                <span style="color: #08739c; text-decoration: underline; cursor: pointer; font-weight: bold;"
                                                    onclick="handleVariableClick('${proceso.idPp}')">
                                                    ${conteo[proceso.idPp] || 0}
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    container.innerHTML += card;
                });
            }

            function getStatusClass(status) {
                switch ((status || "").toLowerCase()) {
                    case "activo": return "bg-success";
                    case "inactivo": return "bg-danger";
                    case "pendiente": return "bg-warning text-dark";
                    default: return "bg-secondary";
                }
            }

            // Filtro de orden
            document.getElementById("ordenarProcesos").addEventListener("change", function () {
                const orden = this.value;
                if (!orden || procesosGlobal.length === 0) {
                    renderProcesos(procesosGlobal, conteoGlobal);
                    return;
                }

                let sorted = [];

                if (orden === "az" || orden === "za") {
                    sorted = [...procesosGlobal].sort((a, b) => {
                        const nombreA = (a.pp || "").toLowerCase();
                        const nombreB = (b.pp || "").toLowerCase();
                        return orden === "az"
                            ? nombreA.localeCompare(nombreB)
                            : nombreB.localeCompare(nombreA);
                    });
                } else if (orden === "mayor-menor" || orden === "menor-mayor") {
                    sorted = [...procesosGlobal].sort((a, b) => {
                        const countA = conteoGlobal[a.idPp] || 0;
                        const countB = conteoGlobal[b.idPp] || 0;
                        return orden === "mayor-menor" ? countB - countA : countA - countB;
                    });
                }

                renderProcesos(sorted, conteoGlobal);
            });

            // Filtro de estatus
            document.getElementById("filtrarEstatus").addEventListener("change", function () {
                const estatusSeleccionado = this.value;

                if (!estatusSeleccionado) {
                    renderProcesos(procesosGlobal, conteoGlobal);
                    return;
                }

                let filtrados = [];

                if (estatusSeleccionado === "iin") {
                    filtrados = procesosGlobal.filter(proceso =>
                        (proceso.gradoMadur || "").toLowerCase() === "información de interés nacional"
                    );
                } else {
                    filtrados = procesosGlobal.filter(proceso =>
                        (proceso.estatus || "").toLowerCase() === estatusSeleccionado.toLowerCase()
                    );
                }

                renderProcesos(filtrados, conteoGlobal);
            });

            // Inicializar tooltips de Bootstrap
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.forEach(function (tooltipTriggerEl) {
                new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Botón de limpiar filtros
            document.getElementById("resetFiltrosBtn").addEventListener("click", function () {
                document.getElementById("ordenarProcesos").selectedIndex = 0;
                document.getElementById("filtrarEstatus").selectedIndex = 0;
                renderProcesos(procesosGlobal, conteoGlobal);
            });

            // Cards de unidad administrativa
            const cards = document.querySelectorAll('.mostrarGrupoBtn');
            cards.forEach(card => {
                card.addEventListener('click', function () {
                    if (this.id !== "btnDireccionSociodemograficas") {
                        alert("Información no disponible");
                    }
                });
            });
        });

        function mostrarVigencia(vigInicial, vigFinal) {
            if (!vigInicial && !vigFinal) return "No disponible";
            if (vigInicial === vigFinal) return vigInicial || "No disponible";
            return `${vigInicial || "No disponible"} - ${vigFinal || "No disponible"}`;
        }

    </script>



    <!--! FOOTER -->
    <div class="container-fluid" style="background-color: #5d5d5d">
        <footer class="bd-footer">
            <div class="pt-4 pb-4">
                <div class="container">
                    <div class="row">
                        <div class="col-lg">
                            <a style="color: white; font-weight: bold; font-size: 15px; font-family: Helvetica, Sans-Serif;">Contacto</a>
                            <ul class="nav flex-column">
                                <li><a href="https://www.inegi.org.mx/"><img class="img-fluid d-block m-1" style="height: 2.5rem; width: 12rem;" src="img/INEGI_c-modified.png"></a></li>
                                <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text" style="color: white"></a></li>
                                <li><a class="text-white d-block pt-1" href="https://www.inegi.org.mx/inegi/contacto.html#Directorios" style="font-family: Helvetica, Sans-Serif;">Directorio</a></li>
                                <li><a class="text-white d-block pt-1" href="https://www.inegi.org.mx/inegi/contacto.html" style="font-family: Helvetica, Sans-Serif;">Solicitud de información</a></li>
                                <br>
                                <ul style="list-style: none; padding: 0; display: flex; gap: 10px; margin-bottom: 5px;">
                                    <li><a href="http://www.facebook.com/pages/inegi-informa/180299958681029" style="color: white"><i class="bi bi-facebook"></i></a></li>
                                    <li><a href="http://twitter.com/inegi_informa" style="color: white"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="bi bi-twitter-x" viewBox="0 0 16 16">
                                        <path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z"/>
                                    </svg></a></li>
                                    <li><a href="https://www.youtube.com/user/INEGIInforma" style="color: white"><i class="bi bi-youtube"></i></a></li>
                                    <li><a href="https://www.instagram.com/inegi_informa/" style="color: white;"><i class="bi bi-instagram"></i></a></li>
                                    <li><a href="https://www.inegi.org.mx/servicios/rss/" style="color: white"><i class="bi bi-rss-fill"></i></a></li>
                                </ul>
                            </ul>
                        </div>
                        <div class="col-lg">
                            <a style="color: white; font-weight: bold; font-size: 15px">Sitios de interés</a>
                            <ul class="nav flex-column">
                                <li class="nav-item mb-2"><a href="https://www.snieg.mx/cni/" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px; font-family: Helvetica, Sans-Serif;">Catálogo Nacional de Indicadores</a></li>
                                <li class="nav-item mb-2"><a href="https://www.cepal.org/es" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px ; font-family: Helvetica, Sans-Serif;">CEPAL</a></li>
                                <li class="nav-item mb-2"><a href="https://www.un.org/sustainabledevelopment/es/objetivos-de-desarrollo-sostenible/" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px ; font-family: Helvetica, Sans-Serif;">ODS-ONU</a></li>
                                <li class="nav-item mb-2"><a href="http://agenda2030.mx/" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px ; font-family: Helvetica, Sans-Serif;">SIODS</a></li>
                                <li class="nav-item mb-2"><a href="https://www.gob.mx/semarnat/acciones-y-programas/sistema-nacional-de-informacion-ambiental-y-de-recursos-naturales" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px ; font-family: Helvetica, Sans-Serif;">SNIARN</a></li>
                                <li class="nav-item mb-2"><a href="#" [routerLink]="['/dg/new']" target="_blank" class="nav-link p-0 text" style="color: white; font-size: 14px ; font-family: Helvetica, Sans-Serif;">Ver más...</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>